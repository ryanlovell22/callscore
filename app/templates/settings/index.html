{% extends "base.html" %}
{% block title %}Settings — CallVerdict{% endblock %}

{% block content %}
<h2>Settings</h2>

<article style="max-width: 600px;">
    <h3>Twilio Credentials</h3>
    <form method="post">
        <label for="twilio_account_sid">Account SID</label>
        <input type="text" id="twilio_account_sid" name="twilio_account_sid"
               value="{{ account_sid }}" placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>

        <label for="twilio_auth_token">Auth Token</label>
        <input type="password" id="twilio_auth_token" name="twilio_auth_token"
               value="{{ masked_token }}" placeholder="Enter your Auth Token">

        <button type="submit">Save</button>
    </form>
</article>

{% if connected or account_sid %}
<article style="max-width: 600px;">
    <h3>Connection Status</h3>
    {% if connected %}
    <p><mark>Connected</mark></p>
    <p><strong>Webhook URL:</strong></p>
    <code>{{ webhook_url }}</code>
    {% else %}
    <p style="color: var(--pico-muted-color);">Not Connected</p>
    {% endif %}
</article>
{% endif %}

<article style="max-width: 600px;">
    <h3>CallRail</h3>
    <form method="post" action="{{ url_for('settings.save_callrail') }}">
        <label for="callrail_api_key">API Key</label>
        <input type="password" id="callrail_api_key" name="callrail_api_key"
               value="{{ masked_callrail_key }}" placeholder="Paste your CallRail API key">
        <button type="submit">Connect</button>
    </form>
    {% if callrail_connected %}
    <p><mark>Connected</mark> — Account: {{ callrail_account_name }}</p>
    <p><strong>Webhook URL (paste in CallRail → Settings → API → Webhooks):</strong></p>
    <code>{{ callrail_webhook_url }}</code>
    <p style="margin-top: 1rem;"><small>Set this as a "Post-call" webhook in CallRail to receive call data automatically.</small></p>
    {% endif %}
</article>

<article style="max-width: 600px;">
    <h3>Timezone</h3>
    <form method="post" action="{{ url_for('settings.save_timezone') }}">
        <label for="timezone">Display Timezone</label>
        <select id="timezone" name="timezone">
            {% for tz in timezones %}
            <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz }}</option>
            {% endfor %}
        </select>
        <button type="submit">Save</button>
    </form>
</article>
{% endblock %}
